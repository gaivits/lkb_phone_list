# check-domain-details-api

# เอกสาร API

API นี้ทำงานร่วมกับ Bot โดยรับข้อมูลจากฝั่ง Front-end แล้วส่งไปยัง Bot เพื่อประมวลผลและเก็บผลลัพธ์ลงในฐานข้อมูล ด้านล่างนี้เป็น API หลักๆ และฟังก์ชันการทำงานของแต่ละ endpoint

## Endpoints

### `/backend/save-result` POST
เป็นการทำงานในส่วนของ Back-end ซึ่งบอทจะส่งข้อมูลมายัง API และ API จะรับข้อมูลนั้นมาบันทึกในตาราง `domain_list` ในฐานข้อมูล ตารางนี้ประกอบด้วยคอลัมน์ดังนี้: `domain_name`, `ex`, `DAPA`, `HIS`

### `/frontend/upload-file-domain` POST
เป็นการทำงานในส่วนของ Front-end ซึ่งรับข้อมูลจากผู้ใช้งานในรูปแบบ JSON เมื่อได้รับข้อมูลมาแล้ว API จะตรวจสอบสถานะของ `batch` ว่าเป็น "Last" หรือยัง หากยังไม่ใช่ "Last" ข้อมูลจะถูกเก็บใน `domains_json` จนกว่าจะเป็น true เมื่อสถานะเป็น "Last" API จะตรวจสอบข้อมูลซ้ำในตารางผลลัพธ์และตารางข้อมูล หากเจอข้อมูลซ้ำจะทำการตัดออก หลังจากนั้นจะทำการตรวจสอบสถานะของการทำงาน:
- หากสถานะเป็น `ready` ข้อมูลจะถูกบันทึกลงฐานข้อมูลและสถานะของชุดข้อมูลจะเปลี่ยนเป็น `process`
- หากไม่ใช่ `ready` ข้อมูลจะถูกบันทึกลงฐานข้อมูลและสถานะของชุดข้อมูลจะเปลี่ยนเป็น `loading`

หลังจากนั้นจะปิดการเชื่อมต่อฐานข้อมูลและล้างข้อมูลใน array ที่ใช้เก็บข้อมูลก่อนบันทึกลงฐานข้อมูล ถ้าหากสถานะเป็น `ready` จะส่ง Event ไปยัง Pusher และเปลี่ยนสถานะเป็น `process` จากนั้น API จะคืนค่าผลลัพธ์

### `/submit-bot` GET
เป็นการทำงานในส่วนของ Front-end เมื่อถูกเรียกใช้งาน API จะตรวจสอบสถานะของการทำงาน หากสถานะเป็น `ready` จะส่ง Event ไปยัง Pusher และเปลี่ยนสถานะเป็น `process` จากนั้นจะคืนค่าบอกให้บอททำงาน หากสถานะไม่เป็น `ready` จะคืนค่าว่า "บอทกำลังทำงานอยู่"

### `/send-data` GET
เป็นการทำงานในส่วนของ Back-end ซึ่งดึงข้อมูลจากฐานข้อมูล โดยจะดึงข้อมูลจากตาราง `all_list` โดยเลือกชุดข้อมูลที่เก่าที่สุดมาทำงานก่อน หลังจากนั้นจะทำการแปลงข้อมูลเป็น JSON และส่งไปพร้อมกับ ID ของชุดข้อมูลนั้นๆ หลังจากส่งข้อมูลแล้วจะทำการอัปเดตสถานะของชุดข้อมูลเป็น `process`

### `/set-status/{new_status}` POST
ทำหน้าที่ในการอัปเดตสถานะการทำงานของบอท

### `/status` GET
ทำหน้าที่แสดงสถานะการทำงานของบอท โดยเริ่มต้นหากเปิดการทำงานของ API ใหม่ มันจะตั้งสถานะของบอทเป็น `ready`

### `/delete-data/{data_id}` DELETE
เป็นการทำงานร่วมกับ Back-end เพื่อลบชุดข้อมูลจาก `all_list` โดยอิงจาก ID ที่บอทส่งกลับมา

### `/frontend/domain-list` GET
ทำหน้าที่ในการดึงข้อมูลทั้งหมดจากตาราง `domain_list` มาแสดง

### `/frontend/all-list` GET
ทำหน้าที่ในการดึงข้อมูลทั้งหมดจากตาราง `all_list` มาแสดง

### `get_status_from_db()`
ฟังก์ชันที่ใช้ในการดึงสถานะของบอทจากฐานข้อมูล

### `set_status_in_db()`
ฟังก์ชันที่ใช้ในการอัปเดตสถานะของบอทในฐานข้อมูล

### `/update-list` POST
ใช้ในการอัปเดตรายการในตาราง `all_list` เมื่อมีการเพิ่มข้อมูลครบ 500 รายการ

### `/update-status/{id}` PUT
ใช้ในการอัปเดตสถานะของชุดข้อมูลในตาราง `domain_list`

### `/backend/check-domain-list` GET
ใช้ในการตรวจสอบโดเมนที่หมดอายุไปแล้ว 7 วัน นับจากวันที่ปัจจุบัน หากพบโดเมนที่หมดอายุจะทำการลบออกจากฐานข้อมูล

---